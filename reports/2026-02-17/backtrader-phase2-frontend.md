# Backtrader Phase 2 â€” å‰ç«¯å›æ¸¬ UI å ±å‘Š

**æ—¥æœŸï¼š** 2026-02-17  
**Sub-agentï¼š** backtrader-phase2-frontend  
**åŸ·è¡Œæ™‚é–“ï¼š** ~5 min  

---

## ğŸ“‹ ä»»å‹™æ‘˜è¦

åœ¨ Stock App å‰ç«¯åŠ å…¥ Walk-Forward é©—è­‰è¦–è¦ºåŒ– UIï¼Œå‘ˆç¾ Phase 1 RF ç­–ç•¥çš„å›æ¸¬å›å‚³çš„ fold è³‡æ–™ï¼Œä¸¦æ–°å¢ç¨ç«‹ Walk-Forward æ·±åº¦åˆ†æé¢æ¿ã€‚

---

## âœ… å®Œæˆé …ç›®

### 1. Walk-Forward åµŒå…¥çµæœé¢æ¿ï¼ˆ`#wfInlineResults`ï¼‰

**ä½ç½®ï¼š** åœ¨ `#backtestResults` çš„äº¤æ˜“æ˜ç´°ä¹‹å¾Œï¼Œç•¶ `result.data.folds` æœ‰è³‡æ–™æ™‚è‡ªå‹•é¡¯ç¤ºã€‚

**é¡¯ç¤ºå…§å®¹ï¼š**
- **æ‘˜è¦å¡ç‰‡ï¼ˆ4 æ ¼ï¼‰ï¼š**
  - é©—è­‰æŠ˜æ•¸
  - å¹³å‡å ±é…¬ï¼ˆå¸¶æ­£/è² è‰²ï¼‰
  - å ±é…¬æ³¢å‹•åº¦ï¼ˆÏƒï¼Œç©©å®šæ€§æŒ‡æ¨™ï¼‰
  - æœ€ä½³ / æœ€å·®æŠ˜ï¼ˆå¸¶é¡è‰²ï¼‰
- **é•·æ¢åœ–ï¼ˆCanvas 2Dï¼‰ï¼š** å„æŠ˜æ¸¬è©¦æœŸå ±é…¬ç‡ %ï¼Œæ­£å€¼ç¶ è‰²ã€è² å€¼ç´…è‰²ï¼Œå« Y è»¸æ¨™ç±¤å’Œé›¶ç·š
- **å„æŠ˜è©³ç´°è¡¨æ ¼ï¼š** æŠ˜æ•¸ / è¨“ç·´æœŸ / æ¸¬è©¦æœŸ / å ±é…¬ / Sharpe / æœ€å¤§å›æ’¤ / æ—¥å‹ç‡

**è§¸ç™¼é‚è¼¯ï¼ˆJSï¼‰ï¼š**
```javascript
if (result.data && result.data.folds && result.data.folds.length > 0) {
    displayWalkForwardResults(result.data.folds);
} else {
    document.getElementById('wfInlineResults').classList.add('hidden');
}
```

### 2. ç¨ç«‹ Walk-Forward æ·±åº¦åˆ†æé¢æ¿

**ä½ç½®ï¼š** åœ¨ `#backtestResults` ä¹‹å¾Œï¼ˆ`</main>` ä¹‹å‰ï¼‰ã€‚

**è¨­å®šè¼¸å…¥ï¼ˆ6 å€‹æ¬„ä½ï¼‰ï¼š**
| æ¬„ä½ | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| ç­–ç•¥é¸æ“‡ | MA Crossover | 4 å€‹ç­–ç•¥å¯é¸ |
| ç¸½èµ·å§‹æ—¥æœŸ | 2 å¹´å‰ | è‡ªå‹•è¨­å®š |
| ç¸½çµæŸæ—¥æœŸ | ä»Šå¤© | è‡ªå‹•è¨­å®š |
| è¨“ç·´çª—å£ï¼ˆæœˆï¼‰ | 6 | min=3, max=24 |
| æ¸¬è©¦çª—å£ï¼ˆæœˆï¼‰ | 1 | min=1, max=12 |
| åˆå§‹è³‡é‡‘ | 100,000 | min=1,000 |

**å‘¼å«ç«¯é»ï¼š** `POST /api/backtest/walk-forward`

**çµæœé¢æ¿ï¼ˆ`#wfAnalysisResults`ï¼‰é¡¯ç¤ºï¼š**
- **æ‘˜è¦å¡ç‰‡ï¼ˆ7 æ ¼ï¼‰ï¼š** ç¸½çª—å£æ•¸ã€å¹³å‡å ±é…¬ã€å ±é…¬æ¨™æº–å·®ã€æœ€ä½³/æœ€å·®ã€å¹³å‡æœ€å¤§å›æ’¤ã€æˆåŠŸçª—å£ç‡ã€ç¸½äº¤æ˜“æ¬¡æ•¸
- **é•·æ¢åœ–ï¼ˆCanvas 2Dï¼‰ï¼š** å„çª—å£æ¸¬è©¦æœŸå ±é…¬ç‡
- **å„çª—å£è©³ç´°è¡¨æ ¼ï¼š** çª—å£ID / è¨“ç·´æœŸ / æ¸¬è©¦æœŸ / å ±é…¬ / æœ€å¤§å›æ’¤ / äº¤æ˜“æ¬¡æ•¸ / ç‹€æ…‹ï¼ˆâœ…/âŒï¼‰

### 3. JS æ–°å¢å‡½å¼æ¸…å–®

| å‡½å¼ | åŠŸèƒ½ |
|------|------|
| `displayWalkForwardResults(folds)` | é¡¯ç¤ºåµŒå…¥çš„ fold è³‡æ–™ |
| `drawWFBarChart(canvasId, data)` | Canvas 2D é•·æ¢åœ–ï¼ˆæ”¯æ´ HiDPI/dprï¼‰ |
| `runWalkForward()` | å‘¼å« `/api/backtest/walk-forward` |
| `displayWalkForwardAnalysis(result)` | é¡¯ç¤ºæ·±åº¦åˆ†æçµæœ |

### 4. å…¶ä»–æ”¹å‹•

- `displayBacktestResults()` æœ«å°¾æ–°å¢ `displayWalkForwardResults()` å‘¼å«
- é é¢ `load` äº‹ä»¶æ–°å¢ WF é è¨­æ—¥æœŸè¨­å®šï¼ˆé è¨­ 2 å¹´ç¯„åœï¼‰
- æ‰€æœ‰ç¾æœ‰åŠŸèƒ½ï¼ˆå›æ¸¬ã€æ¨¡æ“¬äº¤æ˜“ã€åœ–è¡¨ï¼‰**å®Œå…¨æœªä¿®æ”¹**

---

## ğŸ” HTML çµæ§‹é©—è­‰

```
div é–‹æ¨™ç±¤æ•¸ï¼š183
div é—œæ¨™ç±¤æ•¸ï¼š183
å·®å€¼ï¼š       0 âœ…
```

---

## ğŸ—‚ï¸ å¾Œç«¯ API å°æ‡‰é—œä¿‚

| å‰ç«¯æ“ä½œ | å‘¼å«ç«¯é» | è³‡æ–™ä¾†æº |
|---------|---------|---------|
| å›æ¸¬å¾Œè‡ªå‹•é¡¯ç¤º WF | `POST /api/backtest` (å·²æœ‰) | `result.data.folds` |
| ç¨ç«‹ WF åˆ†ææŒ‰éˆ• | `POST /api/backtest/walk-forward` (å·²æœ‰) | `result.windows` + `result.summary` |

**çµè«–ï¼šå¾Œç«¯å·²æœ‰æ‰€æœ‰å¿…è¦ç«¯é»ï¼ŒPhase 2 ç´”å‰ç«¯ä¿®æ”¹å³å¯å®Œæˆã€‚**

---

## ğŸ“Š Walk-Forward API å›å‚³æ ¼å¼èªªæ˜

### `/api/backtest` åµŒå…¥çš„ folds æ ¼å¼ï¼ˆä¾†è‡ª `WalkForwardValidator`ï¼‰

```json
{
  "fold": 1,
  "train_period": { "start": "YYYY-MM-DD", "end": "YYYY-MM-DD" },
  "test_period":  { "start": "YYYY-MM-DD", "end": "YYYY-MM-DD" },
  "metrics": {
    "return": 2.35,
    "sharpe": 1.23,
    "max_drawdown": -3.45,
    "win_rate": 52.3
  },
  "predictions": [...]
}
```

### `/api/backtest/walk-forward` çš„ windows æ ¼å¼ï¼ˆä¾†è‡ª `WalkForwardEngine`ï¼‰

```json
{
  "window_id": 1,
  "train_period": "2023-01-01 to 2023-06-30",
  "test_period":  "2023-07-01 to 2023-07-30",
  "status": "success",
  "total_return": 0.0,
  "max_drawdown": 0.0,
  "total_trades": 0
}
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **RF ç­–ç•¥ Walk-Forward è€—æ™‚è¼ƒé•·**ï¼ˆæ¯çª—å£éœ€é‡æ–°è¨“ç·´ RandomForestï¼‰â€” å‰ç«¯å·²é¡¯ç¤ºã€Œéœ€è¦æ•¸åˆ†é˜ã€æç¤º
2. **fold è³‡æ–™è§¸ç™¼æ¢ä»¶ï¼š** å¾Œç«¯åœ¨æ•¸æ“š â‰¥ 150 å¤©æ™‚æ‰è¨ˆç®—åµŒå…¥ foldï¼ˆ`server.py` ç¬¬ 10 è¡Œ `BacktestEngine.run_backtest()`ï¼‰
3. **Canvas HiDPIï¼š** `drawWFBarChart` å·²è™•ç† `devicePixelRatio` ç¸®æ”¾ï¼ŒRetina è¢å¹•é¡¯ç¤ºæ¸…æ™°

---

## ğŸ”® å¾ŒçºŒå»ºè­°ï¼ˆPhase 3ï¼‰

1. **Walk-Forward ç†±åœ–ï¼š** ä»¥æ—¥æ›†è¦–åœ–å‘ˆç¾å„æœˆä»½ç¸¾æ•ˆ
2. **ç­–ç•¥ç©©å¥æ€§è©•åˆ†ï¼š** æ ¹æ“š return_stdã€win rateã€max_drawdown è¨ˆç®—ç¶œåˆåˆ†æ•¸
3. **è¶…åƒæ•¸æœ€ä½³åŒ–æƒæï¼š** å‰ç«¯åŠ å…¥åƒæ•¸æƒæä»‹é¢
4. **æ¯”è¼ƒå¤šç­–ç•¥ï¼š** åœ¨åŒä¸€å¼µåœ–ä¸Šç–ŠåŠ å¤šå€‹ç­–ç•¥çš„ WF çµæœ

---

*Report generated by sub-agent backtrader-phase2-frontend @ 2026-02-17*
